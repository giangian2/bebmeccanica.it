/**
 * @package      VP One Page Checkout - Joomla! System Plugin
 * @subpackage   For VirtueMart 3+ and VirtueMart 4+
 *
 * @copyright    Copyright (C) 2012-2023 Virtueplanet Services LLP. All rights reserved.
 * @license      GNU General Public License version 2 or later; see LICENSE.txt
 * @authors      Abhishek Das <info@virtueplanet.com>
 * @link         https://www.virtueplanet.com
 */
var VPOPC=window.VPOPC||{},ProOPC=window.ProOPC||{};ProOPC.jQuery=jQuery.noConflict(),function(_,l,o,f,v,u){var n,e,s;v.ajaxPool={},v.cache={},f.options={},v.on_load_bt_country_id=null,v.on_load_st_country_id=null,f.loadOptions=function(t){if(t){if(_.isEmptyObject(f.options))for(var e in t)this.options[e]=t[e];else for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e]);return this}for(var a,o,i=document.querySelectorAll(".vpopc-script-options.new"),r=0,n=i.length;r<n;r++)o=(a=i[r]).text||a.textContent,(o=JSON.parse(o))&&f.loadOptions(o),a.className=a.className.replace(" new"," loaded")},f.setOption=function(t,e){this.options[t]=e},f._=function(t,e){return _.isEmptyObject(f.options)&&f.loadOptions(),e=typeof e!=typeof u&&e,typeof this.options[t.toUpperCase()]!=typeof u?this.options[t.toUpperCase()]:e},f.JText={strings:{},_:function(t,e){return _.isEmptyObject(this.strings)&&this.load(),e=typeof e==typeof u?null:e,typeof this.strings[t.toUpperCase()]!=typeof u?this.strings[t.toUpperCase()]:e},sprintf:function(t,e){return _.isEmptyObject(this.strings)&&this.load(),e=typeof e==typeof u?"":e,(typeof this.strings[t.toUpperCase()]!=typeof u?this.strings[t.toUpperCase()]:"").replace("%s",e)},plural:function(t,e){return _.isEmptyObject(this.strings)&&this.load(),t?((e=typeof e==typeof u?0:parseInt(e))<=1&&(t+="_1"),(typeof this.strings[t.toUpperCase()]!=typeof u?this.strings[t.toUpperCase()]:"").replace("%s",e)):""},load:function(t){if(t){if(_.isEmptyObject(this.strings))for(var e in t)this.strings[e.toUpperCase()]=t[e];else for(var e in t)t.hasOwnProperty(e)&&(this.strings[e.toUpperCase()]=t[e]);return this}for(var a,o,i=document.querySelectorAll(".vpopc-script-strings.new"),r=0,n=i.length;r<n;r++)o=(a=i[r]).text||a.textContent,(o=JSON.parse(o))&&f.JText.load(o),a.className=a.className.replace(" new"," loaded")}},v.init=function(o){(o=v.hasValue(o))&&navigator.userAgent.match(/IEMobile\/10\.0/)&&((n=document.createElement("style")).appendChild(document.createTextNode("@-ms-viewport{width:auto!important}")),document.getElementsByTagName("head")[0].appendChild(n)),o&&v._init(),_("#ProOPC .proopc-btn").each(function(){var e=_(this).attr("onclick"),t=(t=_(this).attr("id"))?_.trim(t):"",a=_(this).data("proopcReady");e&&0<=e.indexOf("ProOPC.")&&!a&&(_(this).click(function(t){return t.preventDefault(),0<=e.indexOf("updateproductqty")?v.updateproductqty(this):0<=e.indexOf("deleteproduct")?v.deleteproduct(this):0<=e.indexOf("guestcheckout")?v.guestcheckout(this):0<=e.indexOf("registerCheckout")?v.registerCheckout(this):0<=e.indexOf("loginAjax")?v.loginAjax(this):0<=e.indexOf("submitOrder")?v.submitOrder(this):0<=e.indexOf("savecoupon")?v.savecoupon(this):void 0}).data("proopcReady",!0).removeAttr("onclick"),(o||e.indexOf("submitOrder")<0)&&_(this).removeAttr("disabled"),a=_(this).data("proopcReady")),"proopc-task-guestcheckout"!=t||a?"proopc-task-registercheckout"!=t||a?"proopc-task-loginajax"!=t||a?"proopc-order-submit"!=t||a?"proopc-task-savecoupon"!=t||a?_(this).hasClass("proopc-task-updateqty")&&!a?_(this).click(function(t){return t.preventDefault(),v.updateproductqty(this)}).data("proopcReady",!0).removeAttr("disabled"):_(this).hasClass("proopc-task-deleteproduct")&&!a&&_(this).click(function(t){return t.preventDefault(),v.deleteproduct(this)}).data("proopcReady",!0).removeAttr("disabled"):_(this).click(function(t){return t.preventDefault(),v.savecoupon(this)}).data("proopcReady",!0).removeAttr("disabled"):(_(this).click(function(t){return t.preventDefault(),v.submitOrder(this)}).data("proopcReady",!0),o&&_(this).removeAttr("disabled")):_(this).click(function(t){return t.preventDefault(),v.loginAjax(this)}).data("proopcReady",!0).removeAttr("disabled"):_(this).click(function(t){return t.preventDefault(),v.registerCheckout(this)}).data("proopcReady",!0).removeAttr("disabled"):_(this).click(function(t){return t.preventDefault(),v.guestcheckout(this)}).data("proopcReady",!0).removeAttr("disabled")});var t,e,a=_("form#EditBTAddres"),i=_("form#EditSTAddres"),r=_("form#proopc-shipment-form"),n=_("form#proopc-payment-form");_("select#virtuemart_state_id",a).attr("id","virtuemart_state_id_field"),_("select#shipto_virtuemart_state_id",i).attr("id","shipto_virtuemart_state_id_field"),_("#city_field, #zip_field, #virtuemart_country_id_field, #virtuemart_state_id_field",a).each(function(){_(this).data("proopcReady")||(v.on_load_bt_country_id=_("#virtuemart_country_id_field",a).val(),_(this).change(function(){v.updateBTaddress(this)}).data("proopcReady",!0)),(t=_(this).attr("onchange"))&&0<=t.indexOf("ProOPC")&&_(this).removeAttr("onchange")}),_("#shipto_city_field, #shipto_zip_field, #shipto_virtuemart_country_id_field, #shipto_virtuemart_state_id_field",i).each(function(){_(this).data("proopcReady")||(v.on_load_st_country_id=_("#shipto_virtuemart_country_id_field",i).val(),_(this).change(function(){v.updateSTaddress(this)}).data("proopcReady",!0)),(t=_(this).attr("onchange"))&&0<=t.indexOf("ProOPC")&&_(this).removeAttr("onchange")}),_("select#virtuemart_state_id_field, select#shipto_virtuemart_state_id_field").each(function(){(_(this).hasClass("required")||_(this).attr("required"))&&!1!==_(this).data("frequired")?_(this).data("frequired",!0):!0!==_(this).data("frequired")&&_(this).data("frequired",!1)}),_("select#proopc-select-st",i).each(function(){_(this).data("proopcReady")||_(this).change(function(){v.selectSTAddress(this)}).data("proopcReady",!0),(t=_(this).attr("onchange"))&&0<=t.indexOf("ProOPC")&&_(this).removeAttr("onchange")}),_('input[name="virtuemart_shipmentmethod_id"][type="radio"]',r).each(function(){_(this).data("proopcReady")||_(this).click(function(){return v.setshipment(this)}).data("proopcReady",!0),(e=_(this).attr("onclick"))&&0<=e.indexOf("ProOPC")&&_(this).removeAttr("onclick")}),_('input[name="virtuemart_paymentmethod_id"][type="radio"]',n).each(function(){_(this).data("proopcReady")||_(this).click(function(){return v.setpayment(this)}).data("proopcReady",!0),(e=_(this).attr("onclick"))&&0<=e.indexOf("ProOPC")&&_(this).removeAttr("onclick")}),_("select",r).each(function(){var t=_(this).closest("fieldset");t.length&&_(this).width(t.width()),_(this).data("proopcReady")||_(this).change(function(){var t=_("form#proopc-shipment-form").find('input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked');t.length&&v.setshipment(t)}).data("proopcReady",!0)}),_("select",n).each(function(){_(this).data("proopcReady")||_(this).change(function(){var t=_("form#proopc-payment-form").find('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked'),e=t.data("pmtype");t.length&&e&&0<=_.inArray(e,["sisowideal","buckaroo","piraeus"])&&v.setpayment(t)}).data("proopcReady",!0)});r=_('input[name="proopc-method"][type="radio"]');r.length&&!r.data("proopcReady")&&r.change(function(){v.opcmethod()}).removeAttr("onchange").data("proopcReady",!0);n=f._("BT_UPDATE_FIELDS"),r=f._("ST_UPDATE_FIELDS");n&&"array"===_.type(n)&&_.each(n,function(t,e){!e||(e=_('[name="'+e+'"]',a)).length&&!e.data("proopcReady")&&e.change(function(){v.updateBTaddress(this)}).data("proopcReady",!0)}),r&&"array"===_.type(r)&&_.each(r,function(t,e){!e||(e=_('[name="'+e+'"]',i)).length&&!e.data("proopcReady")&&e.change(function(){v.updateSTaddress(this)}).data("proopcReady",!0)}),_("input.datepicker-db:hidden").each(function(){var t,e;_(this).data("proopcDateReady")||((e=_(t=this).data("dateInterval"))&&clearInterval(e),e=setInterval(function(){_(t).val()!=_(t).data("oldValue")&&_(t).data("oldValue",_(t).val()).trigger("change")},200),_(t).data("dateInterval",e).data("proopcDateReady",!0))}),_("#ProOPC [data-quantity]").each(function(){_(this).data("proopcReady")||_(this).on("change",v.bindQuantityChange).data("proopcReady",!0)}),_("#ProOPC [data-clearcart]").each(function(){_(this).data("proopcReady")||_(this).on("click",v.clearCart).data("proopcReady",!0)})},v._init=function(){if("function"!=typeof window.atob)return!0;v.ajax("test",{success:function(t){var e,a,o,i;"object"==typeof t&&typeof t.manifest!=typeof u&&(a=_.parseXML(t.manifest),e=_(a),t=window.atob("bGl2ZXVwZGF0ZQ=="),t=(a=e.find(t)).text(),o=window.atob("ZG93bmxvYWRfa2V5"),i=window.atob("cmVxdWlyZWQ="),a.length?0<=t&&e.find("config").find("field").each(function(){_(this).attr("name")==o&&"true"!==_(this).attr(i)&&f.setOption("ALL_OKAY",!1)}):f.setOption("ALL_OKAY",!1))}});var t=document.querySelector("#checkoutFormSubmit");return t&&new MutationObserver(()=>{t.textContent&&_(".proopc-order-confirmation-notice").text(t.textContent),t.disabled&&t.textContent&&t.textContent!==t.getAttribute("data-dvalue")?(_(".proopc-confirm-button-wrapper").addClass("disable-button"),_(".proopc-order-confirmation-notice").removeClass("hide")):(_(".proopc-confirm-button-wrapper").removeClass("disable-button"),_(".proopc-order-confirmation-notice").addClass("hide"))}).observe(t,{attributes:!0,subtree:!0,childList:!0,characterData:!0}),!0},v.initSpinner=function(){v.cache.spinner=v.cache.spinner||new VPSpinner({lines:13,length:3,width:2,radius:5,corners:1,rotate:0,direction:1,color:"#FFF",speed:1.5,trail:60,shadow:!1,hwaccel:!1,className:"proopc-spinner",zIndex:2e9,top:"auto",left:"auto"}).spin();var t={lines:10,length:10,width:4,radius:15,corners:1,rotate:0,direction:1,color:f._("SPINNER_COLOR"),speed:1.5,trail:60,shadow:!1,hwaccel:!0,className:"proopc-page-loader",zIndex:2e9,top:20,left:14};v.cache.loader=v.cache.loader||new VPSpinner(t).spin();t={lines:10,length:5,width:3,radius:8,corners:1,rotate:0,direction:1,color:f._("SPINNER_COLOR"),speed:1.5,trail:40,shadow:!1,hwaccel:!0,className:"proopc-area-loader",zIndex:2e9,top:20,left:14};v.cache.area_loader=v.cache.area_loader||new VPSpinner(t).spin()},v.ajaxManager={tid:null,opt:{type:"POST",dataType:"JSON",url:null,cache:s=e=!(n=[])},setContinuous:function(t){e=!!t},isRunning:function(){return s},addReq:function(t,e){t.opcTask=e||null,n.push(t)},removeReq:function(t){-1<_.inArray(t,n)&&n.splice(_.inArray(t,n),1)},run:function(){var a,o,i,r=this,t=e?500:1e3;s=!0,n.length?(a=n[0].hasOwnProperty("complete")?n[0].complete:null,o=n[0].hasOwnProperty("error")?n[0].error:null,i=n[0].hasOwnProperty("opcTask")&&typeof n[0].opcTask!=typeof u&&n[0].opcTask?"ajaxManager task "+n[0].opcTask+".":"ajaxManager.",n[0].url=n[0].hasOwnProperty("url")?n[0].url:f._("URI"),n[0]=_.extend(!0,{},r.opt,n[0]),n[0].complete=function(t,e){"function"==typeof a&&a.call(this,t,e),n.shift(),r.run.apply(r,[])},n[0].error=function(t,e,a){"function"==typeof o&&o.call(this,t,e,a),console.warn("Ajax error is generated running "+i),e&&"abort"!=e&&a&&"abort"!=a&&(console.log(t),"parsererror"==e&&t.responseText&&console.log(t.responseText),console.log(e),console.log(a))},_.ajax(n[0])):r.tid=setTimeout(function(){r.run.apply(r,[])},t)},stop:function(){n=[],this.tid&&clearTimeout(this.tid),s=!1}},v.opcmethod=function(){var t=_('input[type="radio"][name="proopc-method"]:checked').val();"guest"==t?(_(".proopc-reg-form, .proopc-login-form").addClass("soft-hide").css("opacity",0),_(".proopc-reg-advantages, .proopc-guest-form").removeClass("soft-hide").css("opacity",0),setTimeout(function(){_(".proopc-reg-advantages, .proopc-guest-form").animate({opacity:1},500),v.inputwidth(),v.selectwidth()},50)):"login"==t?(_(".proopc-reg-form, .proopc-reg-advantages, .proopc-guest-form").addClass("soft-hide").css("opacity",0),_(".proopc-login-form").removeClass("soft-hide").css("opacity",0),setTimeout(function(){_(".proopc-login-form").animate({opacity:1},500),v.inputwidth(),v.selectwidth()},50)):(_(".proopc-reg-advantages, .proopc-guest-form, .proopc-login-form").addClass("soft-hide").css("opacity",0),_(".proopc-reg-form").removeClass("soft-hide").css("opacity",0),setTimeout(function(){_(".proopc-reg-form").animate({opacity:1},500,function(){_("#UserRegistration #dynamic_recaptcha_1").length&&v.setStyle()}),v.inputwidth(),v.selectwidth()},50))},v._updateFieldState=function(t,e,a){var o=_(this).siblings(".status");t?(_(this).removeClass("invalid").addClass("valid").removeClass("hasFieldTip").removeAttr("title"),o.removeClass("invalid").removeClass("validating"),v.hasValue(e)&&o.addClass("valid")):null===t?(_(this).removeClass("valid").removeClass("invalid"),o.removeClass("invalid").removeClass("valid").addClass("validating")):(_(this).removeClass("valid").addClass("invalid"),o.addClass("invalid").removeClass("valid").removeClass("validating")),v.hasValue(a)?o.attr("title",f.JText._(a)):o.removeAttr("title"),v.tooltip()},v.hasValue=function(t){return!(typeof t==typeof u||!t||"0"==t)&&t},v._checkAjaxPool=function(t){v.hasValue(t)&&v.ajaxPool.hasOwnProperty(t)&&4!=v.ajaxPool[t].readystate&&v.ajaxPool[t].abort()},v._triggerEvent=function(t){t=v.hasValue(t)&&"string"===_.type(t)?[t]:t,_(o).trigger("vpopc.event",t)},v._reload=function(){var t=_("form#proopc-reload-form");t.length?t.submit():v._reload()},v.ajax=function(o,i){o=v.hasValue(o)?o:"dummy";var t={type:"POST",dataType:"JSON",url:f._("URI"),data:"ctask="+o,cache:!1,async:!0,error:function(t,e,a){"abort"!=e&&"abort"!=a&&(console.warn("Ajax error is generated executing ctask "+o+"."),"parsererror"==e&&t.responseText&&console.log(t.responseText),console.log(t),console.log(e),console.log(a)),typeof i.errorCallback!=typeof u&&"function"==_.type(i.errorCallback)&&i.errorCallback.call(this)}};return i=_.extend(!0,{},t,i),v._checkAjaxPool(o),v.ajaxPool[o]=_.ajax(i),v.ajaxPool[o]},v.bindFormValidator=function(){var t=_("form#UserLogin"),e=_("form#GuestUser"),a=_("form#UserRegistration"),o="change blur keyup";_('input[type="text"]:not(#proopc-secretkey), input[type="password"], input[type="email"]',t).on(o,function(t){_(this).val()?v._updateFieldState.call(this,!0,!1):v._updateFieldState.call(this,!1,!1,"PLG_VPONEPAGECHECKOUT_REQUIRED_FIELD")}),_('input[type="text"], input[type="email"]',e).on(o,function(t){if("email_field"!=_(this).attr("id")&&"guest_email_field"!=_(this).attr("id"))return!1;var e=_(this).val();e&&e.length&&(e=_.trim(e),_(this).val(e)),v.validateEmail(e)?v._updateFieldState.call(this,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):v._updateFieldState.call(this,!1,!0,"PLG_VPONEPAGECHECKOUT_EMAIL_INVALID")}),_('input[type="text"], input[type="email"], input[type="password"], input[type="checkbox"], input[type="radio"], select, textarea',a).on(o,function(t){var e=this,a=_(this).closest("form"),o=_(this).parent(".proopc-input"),i=_(e).attr("required")||_(e).hasClass("required"),r=_(e).attr("id"),n=_(e).val(),s=_(e).attr("type");if(!i&&!o.data("required"))return!0;if(_(e).is("input")&&("checkbox"==s||"radio"==s)){i=_(e).attr("name"),o=i?_('input[type="'+s+'"][name="'+i+'"]',a):null,i=i?_('input[type="'+s+'"][name="'+i+'"]:checked',a):null;return o&&o.length&&i&&i.length&&i.val()&&"0"!=i.val()?v._updateFieldState.call(e,!0,!1,"PLG_VPONEPAGECHECKOUT_INVALID"):v._updateFieldState.call(e,!1,!1),!0}switch(_(e).attr("required",!0),r){case"email_field":case"guest_email_field":n&&n.length&&(n=_.trim(n),_(e).val(n)),v.validateEmail.call(e,n)?(a.find("input#verify_email_field, input#reg_verify_email_field").trigger("change"),f._("AJAXVALIDATION")?(typeof v.cache.emails!=typeof u&&"object"===_.type(v.cache.emails)||(v.cache.emails={}),v.cache.emails.hasOwnProperty(n)?v.cache.emails[n]?(v.removeFieldTip(e,!1),v._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):(v._updateFieldState.call(e,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),_(e).addClass("hasFieldTip").attr("title",f.JText._("COM_USERS_PROFILE_EMAIL1_MESSAGE")),v.fieldTip(),v.showFieldTip(e)):v.ajax("checkemail",{beforeSend:function(t){v._updateFieldState.call(e,null,!1,null)},data:"ctask=checkemail&email="+n,success:function(t){typeof t.valid==typeof u||t.valid?(v.removeFieldTip(e,!1),v._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"),v.cache.emails[n]=!0):(v._updateFieldState.call(e,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),_(e).addClass("hasFieldTip").attr("title",f.JText._("COM_USERS_PROFILE_EMAIL1_MESSAGE")),v.fieldTip(),v.showFieldTip(e),v.cache.emails[n]=!1)}})):v._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):v._updateFieldState.call(e,!1,!0,"PLG_VPONEPAGECHECKOUT_EMAIL_INVALID");break;case"verify_email_field":case"reg_verify_email_field":n&&n.length&&(n=_.trim(n),_(e).val(n));var p=a.find("input#email_field").val();n==p&&n?v._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):v._updateFieldState.call(e,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID");break;case"username_field":v.validateUsername.call(e,n)?f._("AJAXVALIDATION")?(typeof v.cache.usernames!=typeof u&&"object"===_.type(v.cache.usernames)||(v.cache.usernames={}),v.cache.usernames.hasOwnProperty(n)?v.cache.usernames[n]?(v.removeFieldTip(e,!1),v._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):(v._updateFieldState.call(e,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),_(e).addClass("hasFieldTip").attr("title",f.JText._("COM_USERS_PROFILE_USERNAME_MESSAGE")),v.fieldTip(),v.showFieldTip(e)):v.ajax("checkusername",{beforeSend:function(t){v._updateFieldState.call(e,null,!1,null)},data:"ctask=checkuser&username="+n,success:function(t){typeof t.valid==typeof u||t.valid?(v.removeFieldTip(e,!1),v._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"),v.cache.usernames[n]=!0):(v._updateFieldState.call(e,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),_(e).addClass("hasFieldTip").attr("title",f.JText._("COM_USERS_PROFILE_USERNAME_MESSAGE")),v.fieldTip(),v.showFieldTip(e),v.cache.usernames[n]=!1)}})):v._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):v._updateFieldState.call(e,!1,!0,"PLG_VPONEPAGECHECKOUT_USERNAME_INVALID");break;case"password_field":var d=a.find("input#password2_field"),c=a.find("#password-stregth");a.find("#meter-status");d.removeClass("valid").siblings(".status").removeClass("valid"),v.removeFieldTip(e,!1),n&&v.validatePassword.call(e,n)?(v._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"),v.checkStrength.call(e,n)):(_("#password-stregth, #meter-status",a).removeAttr("class").addClass("invalid"),v._updateFieldState.call(e,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),c.text(""));break;case"password2_field":p=a.find("input#password_field").val();n==p&&n?v._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):v._updateFieldState.call(e,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID");break;case"name_field":default:n?v._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):v._updateFieldState.call(e,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID")}})},v.validateForm=function(){return _(this).find("input, select, textarea").trigger("blur"),!_(this).find(".invalid").length||(v.setmsg(1,f.JText._("PLG_VPONEPAGECHECKOUT_REQUIRED_FIELDS_MISSING")),!1)},v.validateEmail=function(t){if(f._("DISABLELIVEVALIDATION"))return!0;return!(!/^([\w-\.]+@([\w-]+\.)+[\w-]{2,10})?$/.test(t)||t.length<5)},v.validateUsername=function(t){if(f._("DISABLELIVEVALIDATION")||f._("DISABLEUSERNAMEVALIDATION"))return!0;return!!/^[a-zA-Z0-9]+$/.test(t)},v.validatePassword=function(t){if(f._("DISABLELIVEVALIDATION"))return!0;var e,a,o,i=this,n=!1;return v.removeFieldTip(i,!1),_(this).removeAttr("title").removeClass("hasFieldTip"),0<=t.indexOf(" ")?(_(i).addClass("hasFieldTip").attr("title",f.JText._("COM_USERS_MSG_SPACES_IN_PASSWORD")),r=!0):f._("PASSWORD_INTEGERS")||f._("PASSWORD_SYMBOLS")||f._("PASSWORD_UPPERCASE")?(e=t.match(/\d/g),a=t.match(/\W/g),o=t.match(/[A-Z]/g),0<f._("PASSWORD_INTEGERS")&&(!e||e.length<f._("PASSWORD_INTEGERS"))?(1==f._("PASSWORD_INTEGERS")?_(i).addClass("hasFieldTip").attr("title",f.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_INTEGERS_N_1",f._("PASSWORD_INTEGERS"))):_(i).addClass("hasFieldTip").attr("title",f.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_INTEGERS_N",f._("PASSWORD_INTEGERS"))),n=!0):0<f._("PASSWORD_SYMBOLS")&&(!a||a.length<f._("PASSWORD_SYMBOLS"))?(1==f._("PASSWORD_SYMBOLS")?_(i).addClass("hasFieldTip").attr("title",f.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_SYMBOLS_N_1",f._("PASSWORD_SYMBOLS"))):_(i).addClass("hasFieldTip").attr("title",f.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_SYMBOLS_N",f._("PASSWORD_SYMBOLS"))),n=!0):0<f._("PASSWORD_UPPERCASE")&&(!o||o.length<f._("PASSWORD_UPPERCASE"))&&(1==f._("PASSWORD_UPPERCASE")?_(i).addClass("hasFieldTip").attr("title",f.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_UPPERCASE_LETTERS_N_1",f._("PASSWORD_UPPERCASE"))):_(i).addClass("hasFieldTip").attr("title",f.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_UPPERCASE_LETTERS_N",f._("PASSWORD_UPPERCASE"))),n=!0)):0<f._("PASSWORD_LENGTH")&&t.length<f._("PASSWORD_LENGTH")&&(_(i).addClass("hasFieldTip").attr("title",f.JText.sprintf("COM_USERS_MSG_PASSWORD_TOO_SHORT_N",f._("PASSWORD_LENGTH"))),n=!0),!n||(v.fieldTip(),v.showFieldTip(this),!1)},v.checkStrength=function(t){if(f._("DISABLELIVEVALIDATION"))return!0;var e=this,a=_(e).closest("form"),o=_("#password-stregth, #meter-status",a),i=a.find("#password-stregth"),a=(a.find("#meter-status"),0);if(t.length<4)return o.removeAttr("class").addClass("short"),i.text(f.JText._("PLG_VPONEPAGECHECKOUT_TOO_SHORT")),v._updateFieldState.call(e,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),!1;4<t.length&&(a+=1),t.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)&&(a+=1),t.match(/([a-zA-Z])/)&&t.match(/([0-9])/)&&(a+=1),t.match(/([!,%,&,@,#,$,^,*,?,_,~])/)&&(a+=1),t.match(/(.*[!,%,&,@,#,$,^,*,?,_,~].*[!,",%,&,@,#,$,^,*,?,_,~])/)&&(a+=1),a<2?(o.removeAttr("class").addClass("weak"),i.text(f.JText._("PLG_VPONEPAGECHECKOUT_WEAK"))):2==a?(o.removeAttr("class").addClass("good"),i.text(f.JText._("PLG_VPONEPAGECHECKOUT_GOOD"))):(o.removeAttr("class").addClass("strong"),i.text(f.JText._("PLG_VPONEPAGECHECKOUT_STRONG"))),v._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")},v.guestcheckout=function(){var t=_("form#GuestUser"),e=_("button#proopc-task-guestcheckout",t),a=_("#proopc-guest-process",t);return v.ajax("guestcheckout",{dataType:"HTML",data:t.serialize(),beforeSend:function(){if(!v.validateForm.call(t))return!1;a.append(v.cache.spinner.el),e.attr("disabled",!0)},success:function(t){a.find(".proopc-spinner").remove(),e.removeAttr("disabled"),v.setmsg("info",f.JText._("PLG_VPONEPAGECHECKOUT_EMAIL_SAVED"),!1),v.processCheckout({error:0}),v._triggerEvent(["guestcheckout.initiated"])},errorCallback:function(){a.find(".proopc-spinner").remove(),e.removeAttr("disabled"),v.setmsg("1","Some error occurred. Check console log for more details.")}}),!1},v.registerCheckout=function(){var t=_("form#UserRegistration"),e=_("button#proopc-task-registercheckout",t),a=_("#proopc-register-process",t);return v.ajax("register",{data:t.serialize()+"&ctask=register",beforeSend:function(){if(!v.validateForm.call(t))return!1;e.attr("disabled",!0),a.append(v.cache.spinner.el)},success:function(t){if(e.removeAttr("disabled"),a.find(".proopc-spinner").remove(),"object"==_.type(t)&&t.msg)if(1==t.error){if(v.setmsg("1",t.msg),t.reload)return v._reload(),!1;"undefined"!=typeof Recaptcha&&Recaptcha.reload(),v._triggerEvent(["registration.failed"])}else v.setmsg(3,t.msg),v._triggerEvent(["registration.success"]),v._onRegistrationSuccess(),t.stop||(f._("RELOAD")?v._reload():setTimeout(function(){v.processCheckout(t)},100));else v._triggerEvent(["registration.success"]),v._onRegistrationSuccess(),"1"==t||1==t?(v.setmsg(3,f.JText._("COM_VIRTUEMART_REG_COMPLETE")),f._("RELOAD")?v._reload():setTimeout(function(){v.processCheckout(t)},100)):"string"===_.type(t)&&-1==t.indexOf("</head>")?v.setmsg(3,f.JText._("PLG_VPONEPAGECHECKOUT_REGISTRATION_NEED_LOGIN")):(v.setmsg(3,f.JText._("COM_VIRTUEMART_REG_COMPLETE")),f._("RELOAD")?v._reload():setTimeout(function(){v.processCheckout({error:0})},100))},errorCallback:function(){e.removeAttr("disabled"),a.find(".proopc-spinner").remove(),v.setmsg(1,"Error submiting registration form. Check console log for more details.")}}),!1},v._onRegistrationSuccess=function(){var t=_("form#UserRegistration"),e=_('input[name="proopc-method"][value="login"]'),a=_("#password-stregth",t),o=_("#meter-status",t);t[0].reset(),t.find("i.status").removeClass("valid").removeClass("invalid"),a.removeAttr("class").text(""),o.removeAttr("class"),e.length&&e.prop("checked",!0).trigger("change")},v.disableSubmit=function(){_("button#proopc-order-submit").attr("disabled","disabled").trigger("disabled")},v.enableSubmit=function(){var t=_("button#proopc-order-submit");v.cache.submitTimeout&&t.attr("disabled")&&clearTimeout(v.cache.submitTimeout),v.cache.submitTimeout=setTimeout(function(){t.removeAttr("disabled").trigger("enabled")},1e3)},v.disableMethodSelection=function(){_('input[name="virtuemart_paymentmethod_id"][type="radio"], input[name="virtuemart_shipmentmethod_id"][type="radio"]').attr("disabled","disabled")},v.enableMethodSelection=function(){_('input[name="virtuemart_paymentmethod_id"][type="radio"], input[name="virtuemart_shipmentmethod_id"][type="radio"]').removeAttr("disabled")},v.addloader=function(t){_(t).each(function(){_(this).find(".proopc-loader-overlay").length||(_(this).append('<div class="proopc-loader-overlay"></div><div class="proopc-area-loader"><span></span></div>'),_(".proopc-area-loader > span").html(v.cache.area_loader.el))}),v.disableSubmit(),_("body").addClass("proopc-loading")},v.removeloader=function(t){_(t).each(function(){_(".proopc-loader-overlay, .proopc-area-loader",this).remove()}),v.enableSubmit(),_("body").removeClass("proopc-loading")},v.addPageLoader=function(t){var e,a;_("#proopc-page-overlay",o).length||(e=_("<div />",{id:"proopc-page-overlay"}),a=_("<span />").append(v.cache.loader.el),a=_("<div />",{id:"proopc-page-spinner"}).append(a),_("body").append(e).append(a),_("#proopc-page-overlay").css({display:"block",height:_("body").outerHeight()}).animate({opacity:.7},300)),v.hasValue(t)&&(a=_("#proopc-order-process"),(t=f.JText._(t,t))&&(a.length||(a=_("<div />",{id:"proopc-order-process"}).appendTo("body")),a.text(t))),_("body").addClass("proopc-page-loading")},v.removePageLoader=function(){_("#proopc-page-overlay, #proopc-page-spinner, #proopc-order-process",o).remove(),_("body").removeClass("proopc-page-loading")},v.getToken=function(){return _("#formToken input:hidden").attr("name")+"=1"},v.pluginLoaded=function(t){return!!_.hasOwnProperty(t)||!!_.fn.hasOwnProperty(t)},v.setmsg=function(t,e,a){a=void 0===a||typeof a===u||a;var o=_("<button />",{type:"button",class:"close"}).attr("onclick","ProOPC.close(this);").html("&times;"),e=_("<span />").html(e),o=_("<div />",{class:"proopc-alert"}).append(o).append(e),e="proopc-warning-msg";"1"==t||"error"==t?e="proopc-error-msg":"2"==t||"warning"==t?e="proopc-warning-msg":"3"==t||"success"==t?e="proopc-success-msg":"4"!=t&&"info"!=t||(e="proopc-info-msg"),o.addClass(e),_("#proopc-system-message").html(o),a&&_("html,body").animate({scrollTop:_("#proopc-system-message").offset().top-f._("SYSTEM_MESSAGE_OFFSET",100)},500)},v.initStateField=function(){if(!v.pluginLoaded("vm2front"))return console.warn('jQuery.vm2front plugin not loaded. Please enable "Using the Script ajax Countries / Regions" option in VirtueMart Configuration.'),!1;var t=_("input#BTStateID").val(),e=_("input#STStateID").val(),t={dest:"#virtuemart_state_id_field",ids:t,prefiks:""};_("select#virtuemart_state_id_field").length&&_("select#virtuemart_country_id_field").vm2front("list",t),t.ids=e,t.prefiks="shipto_",_("select#shipto_virtuemart_state_id_field").length&&(t.dest="#shipto_virtuemart_state_id_field",_("select#shipto_virtuemart_country_id_field").vm2front("list",t))},v.processCheckout=function(t){if(v.hasValue(t)&&"object"===_.type(t)||(t={error:0,msg:[]}),t.error&&t.msg.length){var a="";return _.each(t.msg,function(t,e){a=a+'<div class="error-msg">'+e+"</div>"}),v.setmsg(1,a),!1}v.ajax("procheckout",{dataType:"HTML",data:"task=procheckout",beforeSend:function(){v.addPageLoader("PLG_VPONEPAGECHECKOUT_PLEASE_WAIT"),_(".proopc-tooltip, .proopc-fieldtip").remove()},success:function(t){t=_(t).find("div#ProOPC").html();t?(_("div#ProOPC").html(t),f._("RELOAD")||_("html, body").animate({scrollTop:_("#proopc-system-message").offset().top-100},500),v._triggerEvent(["checkout.finalstage"])):v._reload()},complete:function(){v.initStateField(),v.setStyle(),v.tooltip(),v.inputwidth(),v.selectwidth(),v.bindFormValidator(),v.productdetails(),v.enableSubmit(),v.defaultSP(),v.removePageLoader(),typeof klarna==typeof u&&"undefined"==typeof klarna||v.loadPaymentScripts(),v.loadShipmentScripts()}})},v.loginAjax=function(){var t=_("form#UserLogin"),a=_("button#proopc-task-loginajax",t),e=t.find('input[name="ctask"]:hidden'),o=t.find("#proopc-login-process");return v.validateForm.call(t)&&("login"!=e.val()&&e.val("login"),v.ajax("login",{data:t.serialize(),dataType:"text",beforeSend:function(){o.append(v.cache.spinner.el),a.attr("disabled",!0)},success:function(t){o.find(".proopc-spinner").remove(),a.removeAttr("disabled");var e=!0;"1"==t||1==t?e=!0:t&&-1!=t.indexOf("</head>")||(e=!1),e?(v.setmsg("success",f.JText._("PLG_VPONEPAGECHECKOUT_LOGIN_COMPLETED")),v._triggerEvent(["login.success"]),f._("RELOAD")?v._reload():v.processCheckout()):(v.setmsg("warning",f.JText._("JLIB_LOGIN_AUTHENTICATE")),v._triggerEvent(["login.failed"]))},errorCallback:function(){o.find(".proopc-spinner").remove(),a.removeAttr("disabled"),v.setmsg(1,f.JText._("PLG_VPONEPAGECHECKOUT_SYSTEM_ERROR_JS"))}})),!1},v.updateBTaddress=function(t){var e=_("form#EditBTAddres").serialize();t&&"virtuemart_country_id"==_(t).attr("name")&&v.on_load_bt_country_id&&_(t).val()!=v.on_load_bt_country_id&&(e+="&virtuemart_state_id="),v.ajaxManager.addReq({data:e+"&ctask=savebtaddress&"+v.getToken(),beforeSend:function(){v.disableSubmit()},success:function(t){v._triggerEvent(["checkout.bt.updated"]);var e=!1;t.vat_error&&t.msg?(v.setmsg("warning",t.msg),e=!0,v.updateVATFieldState(!1,t.info)):v.updateVATFieldState(!0,t.info),v.getshipmentpaymentcartlist(e)}},"updateBTaddress")},v.updateSTaddress=function(t){var e=_("form#EditSTAddres").serialize();t&&"shipto_virtuemart_country_id"==_(t).attr("name")&&v.on_load_st_country_id&&_(t).val()!=v.on_load_st_country_id&&(e+="&shipto_virtuemart_state_id="),v.ajaxManager.addReq({data:e+"&ctask=savestaddress&"+v.getToken(),beforeSend:function(){v.disableSubmit()},success:function(t){v._triggerEvent(["checkout.st.updated"]);var e=!1;t.vat_error&&t.msg?(v.setmsg("warning",t.msg),e=!0,v.updateVATFieldState(!1,t.info,"shipto_")):v.updateVATFieldState(!0,t.info,"shipto_"),v.getshipmentpaymentcartlist(e),typeof t.userinfo_id!=typeof u&&_("input#shipto_virtuemart_userinfo_id").val(t.userinfo_id)}},"updateSTaddress")},v.selectSTAddress=function(t){v.ajax("selectstaddress",{data:"ctask=selectstaddress&shipto_virtuemart_userinfo_id="+_(t).val(),beforeSend:function(){v.addloader("#proopc-st-address"),v.disableSubmit()},success:function(t){"object"!==_.type(t)&&(console.warn("Invalid data received"),console.log(t)),_("#proopc-st-address").html(t.editst),v.pluginLoaded("vm2front")?(0<t.stateid?_("input#STStateID").val(t.stateid):_("input#STStateID").val(""),_("#shipto_virtuemart_country_id_field").vm2front("list",{dest:"#shipto_virtuemart_state_id_field",ids:t.stateid,prefiks:"shipto_"})):console.warn('jQuery.vm2front plugin not loaded. Please enable "Using the Script ajax Countries / Regions" option in VirtueMart Configuration.');var e=!1;t.vat_error&&t.msg?(v.setmsg("warning",t.msg),e=!0,v.updateVATFieldState(!1,t.info,"shipto_")):v.updateVATFieldState(!0,t.info,"shipto_"),v.setStyle(),_("#shipto_virtuemart_state_id_field").trigger("liszt:updated"),v.inputwidth(),v.selectwidth(),v.removeloader("#proopc-st-address"),v._triggerEvent(["checkout.st.selected"]),v.getshipmentpaymentcartlist(e)}})},v.setst=function(t){t&&_(t).length&&(v.disableSubmit(),t.checked?v.ajax("btasst",{data:"ctask=btasst",beforeSend:function(){_(".proopc-st-address .edit-address").slideUp()},success:function(t){v._triggerEvent(["checkout.btasst"]);var e=!1;t.vat_error&&t.msg?(v.setmsg("warning",t.msg),e=!0,v.updateVATFieldState(!1,t.info,"shipto_")):v.updateVATFieldState(!0,t.info,"shipto_"),v.getshipmentpaymentcartlist(e)}}):v.ajax("btasst",{data:"ctask=btnotasst",beforeSend:function(){_(".proopc-st-address .edit-address").slideDown(),v.inputwidth(),v.selectwidth()},success:function(){v._triggerEvent(["checkout.btnotasst"]);var t=_("select#proopc-select-st");t.length&&0<t.val()?v.selectSTAddress(t[0]):v.updateSTaddress()}}))},v.getshipmentpaymentcartlist=function(t){t||_("#proopc-system-message").html(""),v.ajax("getshipmentpaymentcartlist",{beforeSend:function(){v.addloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),v.disableSubmit()},success:function(t){return"object"!==_.type(t)||0==t.pqty?(v._reload(),!1):(t.msg&&v.setmsg(t.msg_type,t.msg),_("#proopc-shipments").html(t.shipments),_("#proopc-payments").html(t.payments),_("#proopc-pricelist").html(t.cartlist),_("#proopc-cart-totalqty").text(t.pqty),_("#proopc-item-count").html(f.JText.plural("PLG_VPONEPAGECHECKOUT_N_ITEMS",t.pqty)),0<t.payment_scripts.length&&""!==t.payment_scripts[0]&&(o=t.payment_scripts),""!==t.payment_script[0]&&_.each(t.payment_script,function(t,e){_.getScript(e,function(t,e,a){typeof o!=typeof u&&_.each(o,function(t,e){})})}),0<t.shipment_scripts.length&&""!==t.shipment_scripts[0]&&_.each(t.shipment_scripts,function(t,e){_("head").append('<script type="text/javascript">'+e+"<\/script>")}),v._triggerEvent(["checkout.updated.shipmentpaymentcartlist"]),v.productdetails(),v.setStyle(),v.tooltip(),v.removeloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),v.enableSubmit(),void v.defaultSP());var o},errorCallback:function(){v.removeloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),v.enableSubmit()}})},v.getcartlist=function(e,t){t||_("#proopc-system-message").html(""),v.ajax("getcartlist",{beforeSend:function(){v.addloader("#proopc-pricelist"),v.disableSubmit()},success:function(t){return"object"!==_.type(t)||0==t.pqty?(v._reload(),!1):(t.msg&&v.setmsg(t.msg_type,t.msg),_("#proopc-pricelist").html(t.cartlist),_("#proopc-cart-totalqty").text(t.pqty),_("#proopc-item-count").html(f.JText.plural("PLG_VPONEPAGECHECKOUT_N_ITEMS",t.pqty)),v.hasValue(t.selected_shipment)||_('form#proopc-shipment-form input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked').prop("checked",!1),v.hasValue(t.selected_payment)||_('form#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').prop("checked",!1),v._triggerEvent(["checkout.updated.cartlist"]),v.productdetails(),v.setStyle(),v.removeloader("#proopc-pricelist"),v.enableSubmit(),void(void 0!==e&&e&&(l.location=e)))},errorCallback:function(){v.removeloader("#proopc-pricelist"),v.enableSubmit()}})},v.getcartsummery=function(t){t||_("#proopc-system-message").html(""),v.ajax("getcartsummery",{beforeSend:function(){v.addloader("#proopc-pricelist"),v.disableSubmit()},success:function(t){return"object"!==_.type(t)||0==t.pqty?(v._reload(),!1):(t.msg&&v.setmsg(t.msg_type,t.msg),_("#proopc-cart-totalqty").text(t.pqty),_("#proopc-item-count").html(f.JText.plural("PLG_VPONEPAGECHECKOUT_N_ITEMS",t.pqty)),_("#proopc-pricelist").html(t.cartsummery),v._triggerEvent(["checkout.updated.cartlist"]),v.setStyle(),v.removeloader("#proopc-pricelist"),void v.enableSubmit())},errorCallback:function(){v.removeloader("#proopc-pricelist"),v.enableSubmit()}})},v.getpayments=function(){v.ajax("getpaymentlist",{beforeSend:function(){v.addloader("#proopc-payments"),v.disableSubmit()},success:function(t){if("object"!==_.type(t))return v._reload(),!1;var o;_("#proopc-payments").html(t.payments),0<t.payment_scripts.length&&""!==t.payment_scripts[0]&&(o=t.payment_scripts),""!==t.payment_script[0]&&_.each(t.payment_script,function(t,e){_.getScript(e,function(t,e,a){void 0!==o&&_.each(o,function(t,e){})})}),v._triggerEvent(["checkout.updated.paymentlist"]),v.setStyle(),v.tooltip(),v.removeloader("#proopc-payments"),v.enableSubmit(),v.defaultSP()},errorCallback:function(){v.removeloader("#proopc-payments"),v.enableSubmit()}})},v.getPaymentData=function(t){t=v.hasValue(t),_(".klarna_box_bottom").hide(),_(".vmpayment_cardinfo").removeClass("show").addClass("hide");var e=_("form#proopc-payment-form"),a=e.find('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked');if(!a.length)return!1;var o=a.data("pmtype"),i=a.data("paypalproduct"),r="0",n="0";return i&&(o+=i),o&&_(".vmpayment_cardinfo."+o).length&&(_(".vmpayment_cardinfo."+o).removeClass("hide").addClass("show"),n="1"),"sisowideal"==o&&(n="1"),t&&(n=r="1"),a.hasClass("klarnaPayment")&&v.klarnaOpenClose.call(a[0]),v._triggerEvent(["prepare.data.payment",a[0]]),e.serialize()+"&ajax=1&savecc="+r+"&payment_data="+n},v.getShipmentData=function(){var t="form#proopc-shipment-form",e=_(t),a=e.find('input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked');if(!a.length)return!1;var o=a.val(),i=a.data("usps"),r=a.data("ups"),n=a.data("upsrates");return _("#usps_name-"+o,e).length&&i&&_("#usps_name-"+o,e).val(i.service),_("#usps_rate-"+o,e).length&&i&&_("#usps_rate-"+o,e).val(i.rate),_("#ups_rate-"+o,e).length&&r&&_("#ups_rate-"+o,e).val(r.id),_("#upsrates-"+o,e).length&&n&&_("#upsrates-"+o,e).val(n),v._triggerEvent(["prepare.data.shipment",e[0],a[0]]),_(t).serialize()},v.loadPaymentScripts=function(){v.ajax("getpaymentscripts",{beforeSend:function(){v.addloader("#proopc-payments"),v.disableSubmit()},success:function(t){"object"===_.type(t)&&(_("#proopc-payments").html(t.payments),t.payment_scripts.length&&""!==t.payment_scripts[0]&&(payment_scripts=t.payment_scripts),t.payment_script.length&&""!==t.payment_script[0]&&_.each(t.payment_script,function(t,e){_.getScript(e,function(t,e,a){"undefined"!=typeof payment_scripts&&_.each(payment_scripts,function(t,e){})})})),v.setStyle(),v.tooltip(),v.removeloader("#proopc-payments"),v.enableSubmit(),v.defaultSP()},errorCallback:function(){v.removeloader("#proopc-payments"),v.enableSubmit()}})},v.initPaymentScripts=function(){var t;"object"==typeof Virtuemart&&_("#paypal-button-container").length&&(typeof Virtuemart.onReadyPP==typeof u||_("#paypal-button-container").children().length||_("#paypal-button-container").data("pp.initiated")||(_("#paypal-button-container").html("").data("pp.initiated",!0),_("#paypal-button-login").html(""),_("#paypal-pui-container").html(""),Virtuemart.onReadyPP()),t=_('#proopc-payment-form input[name="virtuemart_paymentmethod_id"]:checked'),"object"==typeof vmPP&&t.length&&"paypal_checkout"===t.data("pmtype")&&"buttons"==t.data("pp")&&typeof vmPP.vmPPOrderId!=typeof u&&!vmPP.vmPPOrderId?(_(".proopc-confirm-button-wrapper").addClass("disable-button"),_(".proopc-order-confirmation-notice").html(vmPP.bt_checkout_txt).removeClass("hide")):(_(".proopc-confirm-button-wrapper").removeClass("disable-button"),_(".proopc-order-confirmation-notice").addClass("hide")))},v.loadShipmentScripts=function(){if(!_("form#proopc-shipment-form select").length)return!1;v.ajax("getshipmentscripts",{beforeSend:function(){v.addloader("#proopc-shipments"),v.disableSubmit()},success:function(t){"object"===_.type(t)&&(_("#proopc-shipments").html(t.shipments),t.shipment_scripts.length&&t.shipment_scripts[0]&&_.each(t.shipment_scripts,function(t,e){_("head, body").find('script[type="text/javascript"]').each(function(){var t=_(this).attr("src");if(void 0===t||!1===t)return _(this).append(e),!1})})),v.setStyle(),v.tooltip(),v.removeloader("#proopc-shipments"),v.enableSubmit(),v.defaultSP()},errorCallback:function(){v.removeloader("#proopc-shipments"),v.enableSubmit()}})},v.defaultSP=function(e){var t,a=_("form#proopc-shipment-form"),o=_("form#proopc-payment-form"),i='input[type="radio"][name="virtuemart_shipmentmethod_id"]',r='input[type="radio"][name="virtuemart_paymentmethod_id"]',n=f._("AUTOSHIPMENT"),s=f._("AUTOPAYMENT"),p="";e=typeof e!=typeof u&&e,0<=n&&!a.find(i+":checked").length&&a.find(i).length&&(0==n&&(n=a.find(i+":first").val()),t=a.find(i+'[value="'+n+'"]'),0<n&&t.length&&(t.attr("checked",!0),p+=v.getShipmentData()));var d=!1;0<=s&&!o.find(r+":checked").length&&o.find(r).length&&(0==s&&(s=o.find(r+":first").val()),t=o.find(r+'[value="'+s+'"]'),0<s&&t.length&&"exp"!=t.data("paypalproduct")&&(t.attr("checked",!0),p&&(p+="&"),p+=v.getPaymentData(),d=!0)),p&&""!==p?v.ajax("setdefaultsp",{data:"ctask=setdefaultsp&"+p,beforeSend:function(){v.addloader("#proopc-shipments, #proopc-payments"),v.disableSubmit()},success:function(t){if(v.hasValue(t.selected_shipment)||_('form#proopc-shipment-form input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked').prop("checked",!1),v.hasValue(t.selected_payment)||_('form#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').prop("checked",!1),0<=s&&d&&v.hasValue(t.selected_payment)&&f._("RELOAD_AFTER_PAYMENT_SELECTION",0))return window.location.reload(),!1;v.enableSubmit(),v.removeloader("#proopc-shipments, #proopc-payments"),typeof t.error!=typeof u&&void 0!==t.error&&t.error?v._triggerEvent(["checkout.defaultsp.failed"]):(v._triggerEvent(["checkout.defaultsp.success"]),v.getcartlist()),e||v.initPaymentScripts()},errorCallback:function(){_('form#proopc-shipment-form input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked').prop("checked",!1),_('form#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').prop("checked",!1),v.enableSubmit(),v.removeloader("#proopc-shipments, #proopc-payments")}}):e||v.initPaymentScripts()},v.setshipment=function(t){var e=v.getShipmentData(),a=_("form#proopc-shipment-form").find('input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked'),o=a.val();if(!e)return!1;v.ajax("setshipment",{data:"ctask=setshipments&"+e,beforeSend:function(){v.disableSubmit(),v.disableMethodSelection()},success:function(t){v.hasValue(t.selected)||(a.prop("checked",!1),t.selected=0),_("input#proopc-savedShipment:hidden").val(t.selected),t.error?(v.setmsg("2",t.msg),v._triggerEvent(["checkout.shipmentselection.failed",o]),v.getcartlist(!1,!0)):(v._triggerEvent(["checkout.shipmentselection.success",o]),v.getcartlist(),f._("RELOADPAYMENTS")&&v.getpayments())},errorCallback:function(){a.prop("checked",!1),v.enableSubmit()}})},v.setpayment=function(t){_(t).hasClass("btn-additional-klarna")&&_(t).closest(".proopc-klarna-payment").find('input[type="radio"][name="virtuemart_paymentmethod_id"]').prop("checked",!0);var o=v.hasValue(t)&&_(t).length&&_(t).hasClass("btn-additional-klarna"),e=!o,t=v.getPaymentData(o),i=_("form#proopc-payment-form").find('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked'),n=i.val();if(!t)return!1;v.ajax("setpayment",{data:"ctask=setpayment&"+t,async:e,beforeSend:function(){v.disableSubmit(),v.disableMethodSelection()},success:function(t,e,a){if(a&&0<=a.getResponseHeader("content-type").indexOf("text/html")&&"undefined"!=typeof klarna&&(_("#proopc-order-submit").removeAttr("disabled"),_("<div />",{id:"proopc-temp",style:"display:none"}).appendTo("body"),_("#proopc-temp").append(t),_("#proopc-temp").find("div#system-message-container").html(),v.setmsg(1,r),v.enableSubmit()),"string"!==_.type(t)&&"string"!=typeof t||(t=_.parseJSON(t)),t.redirect=t.redirect||0,v.hasValue(t.selected)||i.prop("checked",!1),t.error)v.setmsg(2,t.msg),v._triggerEvent(["checkout.paymentselection.failed",n]),v.initPaymentScripts(),v.getcartlist(!1,!0);else if(t.redirect)v.setmsg(4,f.JText._("VMPAYMENT_PAYPAL_REDIRECT_MESSAGE")),v._triggerEvent(["checkout.paymentselection.successs",n]),v.initPaymentScripts(),v.getcartlist(t.redirect,!0);else if(o)v._triggerEvent(["checkout.paymentmethod.additionaldata.saved",n]),v.setmsg(4,f.JText._("PLG_VPONEPAGECHECKOUT_CREDIT_CARD_SAVED")),v.enableSubmit();else{a=!1;if(!t.msg||!i.hasClass("klarnaPayment")&&v.hasValue(t.selected)||(v.setmsg(2,t.msg),a=!0),f._("RELOAD_AFTER_PAYMENT_SELECTION",0))return window.location.reload(),!1;v._triggerEvent(["checkout.paymentselection.successs",n]),v.initPaymentScripts(),v.getcartlist(!1,a)}},errorCallback:function(){i.prop("checked",!1),v.enableSubmit()}})},v.deleteproduct=function(e){return v.ajax("deleteproduct",{data:"ctask=deleteproduct&id="+_(e).data("vpid"),beforeSend:function(){v.addloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),v.disableSubmit()},success:function(t){if(v._triggerEvent(["checkout.products.deleted",_(e).data("vpid")]),_("#proopc-system-message").html(""),_(".proopc-product-hover").addClass("hide"),0==t.pqty||!t.pqty)return v._reload(),!1;0<_("input#proopc-cart-summery").length?v.getcartsummery():v.getshipmentpaymentcartlist(),_("body").trigger("updateVirtueMartCartModule")},errorCallback:function(){v.enableSubmit()}}),!1},v.clearCart=function(t){t.preventDefault();t=_("form#proopc-reload-form");return t.length?(_("<input />").attr("name","ctask").attr("type","hidden").val("clearcart").appendTo(t),t.submit()):window.location.href=f._("URI")+"&ctask=clearcart",!1},v.bindQuantityChange=function(){var t="string"==typeof(t=_(this).val())?t.replace(/\D/g,""):_(this).data("quantity");if(_(this).val(t),f._("AUTO_UPDATE_QUANTITY"))return v.updateproductqty(this)},v.updateproductqty=function(t){var e=!1;return _(".proopc-qty-input").each(function(){if(_(this).data("quantity")!=_(this).val())return!(e=!0)}),e&&v.ajax("updateProductQty",{data:_("#proopc-carttable-form").serialize(),beforeSend:function(){v.addloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),v.disableSubmit()},success:function(t){return"object"!==_.type(t)?(v._reload(),!1):(t.error?v.setmsg(2,t.msg):(v._triggerEvent(["checkout.products.updated",t.pqty]),t.msg?v.setmsg(2,t.msg):_("#proopc-system-message").html("")),_(".proopc-product-hover").addClass("hide"),0!=t.pqty&&t.pqty?(0<_("input#proopc-cart-summery").length?v.getcartsummery(!0):v.getshipmentpaymentcartlist(!0),void _("body").trigger("updateVirtueMartCartModule")):(v._reload(),!1))},errorCallback:function(){v.enableSubmit()}}),!1},v.savecoupon=function(t){var a=_("input#proopc-coupon-code"),o=a.val(),i=a.data("default");return _("#proopc-system-message").html(""),o&&o!=i?v.ajax("setcoupon",{data:"ctask=setcoupon&coupon_code="+encodeURIComponent(o),beforeSend:function(){v.addloader("#proopc-coupon"),v.disableSubmit()},success:function(t){if("object"!==_.type(t))return v._reload(),!1;v._triggerEvent(["checkout.coupon.submitted",o,t.msg]);var e=t.error||"success";a.val(i),!t.wait&&t.msg&&v.setmsg(e,t.msg),v.removeloader("#proopc-coupon"),f._("RELOADALLFORCOUPON")?v.getshipmentpaymentcartlist(!0):v.getcartlist(null,!0),_("body").trigger("updateVirtueMartCartModule")},errorCallback:function(){v.setmsg(1,"An error has occurred while processing coupon code. See console log for more details."),v.removeloader("#proopc-coupon"),v.enableSubmit()}}):v.setmsg(2,f.JText._("PLG_VPONEPAGECHECKOUT_COUPON_EMPTY")),!1},v.fieldGroups=[["title","first_name"],["middle_name","last_name"],["zip","city"],["shipto_middle_name","shipto_last_name"],["shipto_zip","shipto_city"]],v.inputwidth=function(){var a,o;_("form#EditBTAddres").children().each(function(t){_(this).data("pos",t)}),_("form#EditSTAddres").children().each(function(t){_(this).data("pos",t)}),f._("GROUPING")&&"array"===_.type(v.fieldGroups)&&v.fieldGroups.length&&_.each(v.fieldGroups,function(t,e){"array"===_.type(e)&&2==e.length&&(a=_("."+e[0]+"-group"),o=_("."+e[1]+"-group"),a.length&&o.length&&a.data("pos")+1==o.data("pos")&&_("."+e[0]+"-group, ."+e[1]+"-group").wrapAll('<div class="proopc-row group-enabled" />'))}),_('.proopc-bt-address input[type="text"], .proopc-bt-address input[type="email"], .proopc-st-address input[type="text"], .proopc-st-address input[type="email"], .proopc-additional-info input[type="text"], .proopc-confirm-order input[type="text"]').each(function(){_(this).css("width","");var t=_(this).parent(".inner").width();t&&_(this).width(t-15)}),_('.proopc-register-login input[type="text"], .proopc-register-login input[type="password"], .proopc-register-login input[type="email"]').each(function(){_(this).css("width","");var t=_(this).parent(".proopc-input").width();t&&_(this).width(t-27)}),_(".proopc-register-login button").each(function(){_(this).css("width","");var t=_(this).parent(".proopc-input").outerWidth(!0);t&&_(this).width(t)});var t=_("#proopc-coupon .proopc-input-append").width(),e=_("#proopc-coupon").find("button.proopc-btn").outerWidth(!0);_("#proopc-coupon-code").width(t-e-20).css("margin-right",5)},v.selectwidth=function(){_(".proopc-bt-address select, .proopc-st-address select, .proopc-additional-info select, .proopc-confirm-order select").each(function(){_(this).css("width","");var t=_(this).parent(".inner").width();t&&_(this).outerWidth(t-3)}),_(".proopc-register-login select").each(function(){_(this).css("width","");var t=_(this).parent(".proopc-input").width();t&&_(this).outerWidth(t)})},v.productdetails=function(){return!!_(".proopc-cart-product").length&&(v.pluginLoaded("hoverIntent")?void _(".proopc-cart-product").each(function(){var t=this,e=_(t).data("details"),e=_("#"+e),a=_("table.proopc-p-info-table",e);_(t).hoverIntent({interval:100,sensitivity:6,timeout:100,over:function(){_(t).addClass("open"),_(a).width(_(t).width()),_(e).show().css("top",_(t).position().top).animate({opacity:1,top:_(t).position().top+_(t).height()},150,"linear")},out:function(){_(t).removeClass("open"),_(e).animate({opacity:0},100,"linear",function(){_(this).hide().css("top",0)})}})}):(console.warn("jQuery.hoverIntent plugin is not loaded. Product mouseover effect is being disabled to avoid errors."),!1))},v.tooltip=function(){var a=_.now(),r=_("<div />",{class:"tooltip-title"}),n=_("<div />",{class:"tooltip-body"}),s=_("<p />",{class:"proopc-tooltip"});_(".hover-tootip").each(function(t){var e=_(this).attr("title");e&&(_(this).attr("data-tiptext",e).removeAttr("title"),_(this).data("uniqueid","proopc-tip-"+a+"-key-"+t)),_(this).hover(function(t){t.stopPropagation();var e=_(this).data("uniqueid"),a=_(this).attr("data-tiptext"),o=null,i=null;e&&a&&(_("#"+e).length||(i=0<=a.indexOf("::")?(o=(t=a.split("::"))[0],t[1]):(o=null,a))&&(s.html("").attr("id",e),o&&s.append(r.html(o)),s.append(n.html(i)).appendTo("body")),_("#"+e).addClass("show"))},function(){var t=_(this).data("uniqueid");t&&_("#"+t).length&&(_("#"+t).removeClass("show"),setTimeout(function(){_("#"+t).remove()},180))}).mousemove(function(t){var e,a,o,i=_(this).data("uniqueid");i&&_("#"+i).length&&(a=(e=_("#"+i)).outerWidth(),o=e.outerHeight(),i=_(this).outerHeight(),e.css({top:t.pageY-(o+i+2),left:t.pageX-a/2}))})})},v.fieldTip=function(){_(".hasFieldTip").hover(function(){_(this).attr("title")&&v.showFieldTip(this)},function(){v.removeFieldTip(this,!0)})},v.showFieldTip=function(t){var e,a,o,i,r,n=_(t),s="field-tip-"+_.now(),p=_(t).attr("title"),d=_(t).outerWidth(),c=_(t).offset();n.data("tip")||(n.data("tipText",p).data("tip","#"+s).removeAttr("title"),e=_("<p />",{id:s,class:"proopc-fieldtip",style:"margin: 0px;"}),p=_("<div />",{class:"fieldtip-body"}).html(p),e.html(p).css("visibility","hidden").appendTo("body"),a=e.outerWidth(),o=e.outerHeight(),i=c.top-(o+6),r=c.left+(d-a)/2,e.css({top:i,left:r,visibility:""}).fadeIn(200),_(l).resize(function(){var t;t&&clearTimeout(t),t=setTimeout(function(){d=n.outerWidth(),c=n.offset(),a=e.outerWidth(),o=e.outerHeight(),i=c.top-(o+6),r=c.left+(d-a)/2,e.css({top:i,left:r})},200)}),n.is(":hidden")&&v.removeFieldTip(t,!0),_('input[name="proopc-method"][type="radio"]').change(function(){v.removeFieldTip(t,!0)}))},v.removeFieldTip=function(t,e){var a=_(t),t=a.data("tip");t&&_(t).length&&(e&&a.attr("title",a.data("tipText")),a.data("tip",null),_(t).animate({opacity:0},200,function(){_(this).remove()}))},v.setStyle=function(){var t=0,e=".proopc-register > .proopc-inner, .proopc-login > .proopc-inner";_(e).css("min-height","").each(function(){_(this).outerHeight()>t&&(t=_(this).outerHeight())}),0<t&&_(e).css("min-height",t);var a,o,i,r=_("#ProOPC #dynamic_recaptcha_1 table:visible");if(r.length&&(d=r.width(),e=(s=r.closest(".proopc-input")).siblings(".proopc-input-group-level"),s.width(d),r=_(".proopc-register > .proopc-inner").width()-35,e.width(r-d)),_("table.cart-summary.proopc-table-striped td").each(function(){a=(a=_(this).text())?_.trim(a):"",o=(o=_(this).html())?_.trim(o):"",(a&&a.length||o&&o.length)&&!_(this).is(":empty")||_(this).addClass("cell-empty")}),_("table.cart-summary.proopc-table-striped span.vm-price-desc").each(function(){a=(a=_(this).text())?_.trim(a):"",o=(o=_(this).html())?_.trim(o):"",(a&&a.length||o&&o.length)&&!_(this).is(":empty")||_(this).hide()}),_(".proopc-p-price > div, .proopc-taxcomponent > div, .proopc-p-discount > div").each(function(){_(this).is(":visible")&&_(this).css("display","inline")}),_(".proopc-login-message-cont").hover(function(){_(".proopc-logout-cont").removeClass("hide")},function(){_(".proopc-logout-cont").addClass("hide")}),_(".proopc-logout-cont").css("min-width",_(".proopc-loggedin-user").width()),_('[data-vpopc="redirect"]').off("click").on("click",function(t){t.preventDefault();var e=(e=_(this).attr("href"))?e.replace("#",""):null,t=_(this).data("vphref");return e?(e=_("<input />",{type:"hidden",name:"ctask",value:e}),_("<form />",{action:f._("URI"),method:"post"}).html(e).appendTo("body").submit()):t&&(l.location.href=t),!1}),typeof l.bonusCartItemIds!=typeof u&&void 0!==l.bonusCartItemIds&&_.each(l.bonusCartItemIds,function(t,e){var a;e.userCanUpdateQuantity||(a=_('input[data-vpid="'+e.cartItemId+'"]').parent(".proopc-input-append"),e=_(a).children('input[name="quantity"]').val(),_(a).hasClass("bonusSet")||(a.before(e),_(a).addClass("bonusSet")),a.hide(),a.parent().find("button.remove_from_cart").hide())}),f._("STYLERADIOCHEBOX")&&(_('#UserRegistration input[type="radio"], #EditBTAddres input[type="radio"], #EditSTAddres input[type="radio"]').each(function(){_(this).parent("label").length||(_(this).css({width:"auto",float:"left"}),(i=_(this).attr("id"))&&_('label[for="'+i+'"]').addClass("proopc-radio-label"))}),_('#UserRegistration input[type="checkbox"], #EditBTAddres input[type="checkbox"], #EditSTAddres input[type="checkbox"]').each(function(){_(this).parent("label").length||(_(this).css({width:"auto",float:"left",margin:"2px 0 0"}).parent(".proopc-input-append").css("padding-top","4px").siblings("br").remove(),(i=_(this).attr("id"))&&_('label[for="'+i+'"]').css({float:"left","padding-left":"10px","padding-right":"10px"}).insertAfter(this))})),_('#UserRegistration input[type="radio"]:required, #UserRegistration input[type="radio"].required').parent(".proopc-input-append").addClass("proopc-input-append-radio"),_('#UserRegistration input[type="checkbox"]:required, #UserRegistration input[type="checkbox"].required').parent(".proopc-input-append").addClass("proopc-input-append-checkbox"),_(".proopc-creditcard-info").each(function(){var t,e,a,o;_(this).closest(".vmpayment_cardinfo").length||(t=_(this).prevAll('input[name="virtuemart_paymentmethod_id"]')).length&&(e=t.data("pmtype"),a=t.data("paypalproduct"),o=" hide",e&&(a&&(e+=a),t.is(":checked")&&(o=" show"),_(this).wrap('<span class="vmpayment_cardinfo additional-payment-info '+e+o+'" />')))}),typeof klarna!=typeof u&&"undefined"!=typeof klarna&&v.callKlarna(),_("#sisow_bank").closest("fieldset").length&&_("#sisow_bank").width(_("#sisow_bank").closest("fieldset").width()),_("#monthinstallments").closest(".proopc-row").length&&_("#monthinstallments").width(_("#monthinstallments").closest(".proopc-row").width()),_(".vmpayment_cardinfo").parent().is("div")&&_(".vmpayment_cardinfo").unwrap(),_('#ProOPC select[name="virtuemart_state_id"], #ProOPC select[name="shipto_virtuemart_state_id"]').on("liszt:updated",function(){var t,e=_(this).attr("id"),a=e&&_("select#"+e).length?_("select#"+e)[0]:this,o=_(a).closest("form"),i=_('select[name="virtuemart_country_id"]',o),r=e?_('label[for="'+e+'"]'):null,n=r&&r.length?r.find(".asterisk"):null,s=_(a).find("optgroup"),p=(p=_(a).find("option:first")).length&&!p.val()?p:null,d=f.JText._("COM_VIRTUEMART_LIST_EMPTY_OPTION"),r=_("input#STStateID").val();p&&(p.data("selectText")?d=p.data("selectText"):(d=p.text(),p.data("selectText",d))),i.length||(i=_('select[name="shipto_virtuemart_country_id"]',o)),0<(t=i.val())&&s.each(function(){(!_(this).data("forcountry")||_(this).data("forcountry")==t)&&_("option",this).length?_(this).data("forcountry",t):_(this).remove()}),_(a).removeClass("required"),s&&s.length?(_(a).removeAttr("readonly"),_(a).data("frequired")&&(_(a).attr("required",!0),n&&n.show()),p&&p.text(d),"shipto_virtuemart_state_id"==e&&0<r&&!_(a).val()&&s.find('option[value="'+r+'"]').length&&(s.find('option[value="'+r+'"]').attr("selected",!0),_(a).val(r))):(_(a).removeAttr("required").attr("readonly",!0),n&&n.hide(),p&&p.text(f.JText._("COM_VIRTUEMART_NONE"))),_(a).trigger("opcvalidate")}),f._("REMOVEUNNECESSARYLINKS")&&f._("EDITPAYMENTURI")&&(_("span.vmpayment a").each(function(){var t=_(this).closest("label").siblings(".vmpayment_cardinfo");t.length&&(_("<div />",{class:"proopc-payment-text"}).text(_(this).text()).prependTo(t),_(this).remove())}),_("#ProOPC a").each(function(){_(this).attr("href")==f._("EDITPAYMENTURI")&&_(this).remove()})),f._("TOSFANCY")){if(!v.pluginLoaded("fancybox"))return console.warn("jQuery.fancybox plugin is not loaded. Terms of Service may not display properly."),!1;var n=_("div#proopc-tos-fancy"),s=n.parent(),p=_.easing&&_.easing.hasOwnProperty("elastic")?"elastic":"fade";_('[data-tos="fancybox"]').fancybox({titlePosition:"inside",padding:0,showCloseButton:!1,centerOnScroll:!0,transitionIn:"fade",transitionOut:p,overlayOpacity:.8,overlayColor:"#000",onClosed:function(){_(this.href).length||(s.html(n),_("div#proopc-tos-fancy button.fancy-close").click(function(t){t.preventDefault(),_.fancybox.close()}))}}),_("div#proopc-tos-fancy button.fancy-close").click(function(t){t.preventDefault(),_.fancybox.close()})}f._("RELOAD")&&!_("#ProOPC").hasClass("loaded")&&_(".proopc-reload").length&&_("html,body").animate({scrollTop:_("#proopc-system-message").offset().top-100},500,function(){_("#ProOPC").addClass("loaded")});var d=_('input.klarnaPayment[type="radio"]'),p=_("form#proopc-payment-form").find('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked');d.length&&(d.attr("onclick","return ProOPC.setpayment(this);").closest("table").addClass("proopc-klarna-payment"),p.length&&v.klarnaOpenClose.call(p[0])),_(".checkout-advertise .pp-credit a, .checkout-advertise .pp-express a").removeAttr("target")},v.isMobile=function(){var t=navigator.userAgent.toLowerCase(),e="PC";return t.match(/android/i)?e="Android":t.match(/blackberry/i)?e="BlackBerry":t.match(/iphone/i)?e="iPhone":t.match(/ipad/i)?e="iPad":t.match(/ipod/i)?e="iPod":t.match(/opera mini/i)?e="Opera Mini":t.match(/iemobile/i)?e="IEMobile":t.match(/fban|fbav/i)&&(e="Facebook"),"PC"==e?(_("html").addClass("device-is-pc").removeClass("device-is-handheld"),!1):(_("html").addClass("device-is-handheld").removeClass("device-is-pc"),e)},v.klarnaOpenClose=function(t){if(!_(this).hasClass("klarnaPayment"))return!1;var e,a=_(this).closest(".proopc-klarna-payment"),o=_(".klarna_box_bottom_right .klarna_box_bottom_content .btn-additional-klarna",a);a.siblings().find(".klarna_box_bottom:visible").hide(),_('.proopc-klarna-payment input[name="klarna_paymentmethod"]').attr("disabled",!0),_('input[name="klarna_paymentmethod"]',a).removeAttr("disabled"),_(".klarna_box_bottom:hidden",a).css("opacity",0).show(),_('input[type="text"]',a).width("auto"),_('input[type="text"]:visible').each(function(){(e=_(this).parent("div").width())&&_(this).css("max-width",e-13)}),_(".proopc-klarna-payment .klarna_box_bottom_input_combo").each(function(){_(this).children("div").width("100%")}),o.length||(o=_("<button />",{type:"button",class:"proopc-btn btn-additional-klarna",onclick:"return ProOPC.setpayment(this);",style:"margin-top: 15px;"}).text(f.JText._("COM_VIRTUEMART_SAVE")),_(".klarna_box_bottom_right .klarna_box_bottom_content",a).append(o)),_("div.klarna_box_bottom_title:visible, div.klarna_box_bottom_title:visible",a).removeAttr("style"),_("#box_klarna_consent_invoice:visible",a).parent("div").addClass("proopc-klarna-consent-container").width("auto"),_("#box_klarna_consent_part:visible",a).parent("div").addClass("proopc-klarna-consent-container").width("auto"),_(".klarna_box_bottom:visible",a).animate({opacity:1},300)},v.callKlarna=function(){var t=_("body");_("#klarna_baloon").clone(),_("#klarna_blue_baloon").clone();_(".klarna_baloon, .klarna_blue_baloon",t).remove(),typeof klarna!=typeof u&&"undefined"!=typeof klarna&&(klarna.doDocumentIsReady!==typeof u&&"function"===_.type(klarna.doDocumentIsReady)&&klarna.doDocumentIsReady(_(".klarna_box")),klarna.unary_checkout||(t=_('#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked'),klarna.gChoice="",t.hasClass("klarnaPayment")&&(klarna.stype=t.data("stype"),klarna.gChoice=t.attr("id")),t.length&&v.klarnaOpenClose.call(t[0])),klarna.baloons_moved=!0)},v.getKlarnaForm=function(){var t=_('#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked');if(!t.hasClass("klarnaPayment"))return!1;var a,t=t.closest("table").find("*").serializeArray(),o=_("<form />");return t.push({name:"task",value:"setpayment"}).push({name:"view",value:"cart"}).push({name:"klarna_paymentmethod",value:selectedPayment.next("input").val()}),_.each(t,function(t,e){a=_("<input />",{type:"hidden",name:e.name,value:e.value}),o.append(a)}),o},v.setPreloaderState=function(t){var e=_("#proopc-preloader");"init"==t?_(e).addClass("proopc-started"):(setTimeout(function(){_(e).addClass("proopc-loaded").removeClass("proopc-started")},100),setTimeout(function(){_(e).remove()},600))},v.canCheckout=function(){if(!_("#ProOPC").length)return!1;var t=_("#ProOPC")[0];_(t).hasClass("emptyCart-view")?v.setPreloaderState("done"):(v._canCheckoutTask.call(t,!0),setInterval(function(){v._canCheckoutTask.call(t,!1)},9e5))},v._canCheckoutTask=function(e){var a=this;v.ajax("cancheckout",{beforeSend:function(){e&&v.setPreloaderState("init")},success:function(t){if("object"!==_.type(t))return _(a).removeClass("canCheckout"),l.location.reload(!0),!1;e&&v.setPreloaderState("done"),t.error?(_(a).removeClass("canCheckout"),t.reload&&v._reload()):_(a).addClass("canCheckout")},errorCallback:function(){e&&v.setPreloaderState("done")}})},v.validateAllForms=function(){var t=_("form#EditBTAddres"),e=_("form#EditSTAddres"),a=_("#proopc-shipments"),o=_("#proopc-payments"),i=_("form#proopc-payment-form"),r=_("form#cartFormFields"),n=(r=r&&r.length?r:_("form#checkoutForm")).find('input[name="tos"][type="checkbox"]'),s=_("#proopc-entry-single"),p=_('input#STsameAsBT[type="checkbox"]').length&&_('input#STsameAsBT[type="checkbox"]').is(":checked");if(s.length){var d=_('input[name="proopc-method"][type="radio"]',s),c=_('input[name="proopc-method"][value="guest"][type="radio"]',s);if(!d.length)return v.setmsg(1,f.JText._("PLG_VPONEPAGECHECKOUT_LOGIN_NEEDED")),!1;if(!c.length)return v.setmsg(1,f.JText._("PLG_VPONEPAGECHECKOUT_ONLY_REGISTERED_USER_CAN_CHECKOUT")),!1;c.attr("checked",!0).trigger("change")}d=f._("EU_VAT_FIELD");if(d&&"string"===_.type(d)&&_("input#"+d+"_field").length&&_("input#"+d+"_field").hasClass("invalid"))return v.setmsg(1,f.JText._("PLG_VPONEPAGECHECKOUT_EU_VAT_INVALID")),!1;c=_('#ProOPC input#STsameAsBT[type="checkbox"]');if(c.length&&!c.is(":checked")){d="shipto_"+d;if(d&&"string"===_.type(d)&&_("input#"+d+"_field").length&&_("input#"+d+"_field").hasClass("invalid"))return v.setmsg(1,f.JText._("PLG_VPONEPAGECHECKOUT_EU_VAT_INVALID")),!1}if(!v._validateAddressForms.call(t))return v.setmsg(1,f.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")),!1;if(!p&&!v._validateAddressForms.call(e))return v.setmsg(1,f.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")),!1;if(a.length&&!_('input[name="virtuemart_shipmentmethod_id"][type="radio"]',a).is(":checked"))return v.setmsg(1,f.JText._("COM_VIRTUEMART_CART_NO_SHIPMENT_SELECTED")),!1;if(o.length&&!_('input[name="virtuemart_paymentmethod_id"][type="radio"]',o).is(":checked")&&_("input#vpopc_pp_express_selected").val()<=0)return v.setmsg(1,f.JText._("COM_VIRTUEMART_CART_NO_PAYMENT_SELECTED")),!1;i=_('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked',i);if(i.length&&i.hasClass("klarnaPayment")){var l,i=i.closest("table"),u=!1,m=[];_("input, select, textarea, .klarna_box_bottom_title",i).removeClass("invalid"),_("input:visible",i).not(":checkbox").each(function(){_(this).val()||(_(this).addClass("invalid").prev(".klarna_box_bottom_title").addClass("invalid"),(l=_(this).prev(".klarna_box_bottom_title").text())&&m.push(l),u=!0)});var h=!1;if(_("select",i).each(function(){var t=_(this).val();t&&""!=parseInt(t)&&0!=parseInt(t)&&!isNaN(parseInt(t))||(_(this).addClass("invalid"),_(this).closest(".klarna_box_bottom_input_combo").prev(".klarna_box_bottom_title").addClass("invalid"),(l=_(this).closest(".klarna_box_bottom_input_combo").prev(".klarna_box_bottom_title").text())&&!h&&(m.push(l),h=!0),u=!0)}),_('input[type="checkbox"]',i).each(function(){_(this).is(":checked")||(_(this).addClass("invalid").next(".klarna_box_bottom_title").addClass("invalid"),m.push("Klarna: "+f.JText._("COM_VIRTUEMART_CART_PLEASE_ACCEPT_TOS")),u=!0)}),_("input, select, textarea",i).change(function(){_(this).is("input")&&""!=_(this).val()&&_(this).removeClass("invalid").prev(".klarna_box_bottom_title").removeClass("invalid"),!_(this).is("select")||""==_(this).val()&&"0"==_(this).val()||_(this).removeClass("invalid").closest(".klarna_box_bottom_input_combo").prev(".klarna_box_bottom_title").removeClass("invalid"),_(this).is('input[type="checkbox"], input[type="radio"]')&&_(this).is(":checked")&&_(this).removeClass("invalid").next(".klarna_box_bottom_title").removeClass("invalid")}),u&&m.length)return v.setmsg(1,f.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")+": "+m.join(", ")+"."),!1}if(n.length&&n.attr("required")&&!n.is(":checked")){n=(n=n.data("label"))||f.JText._("COM_VIRTUEMART_CART_PLEASE_ACCEPT_TOS");return v.setmsg(1,n),!1}return!!v._validateAddressForms.call(r)||(v.setmsg(1,f.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")),!1)},v._validateAddressForms=function(){return _("input, select, textarea",this).each(function(){_(this).attr("id");_(this).off("opcvalidate").on("change opcvalidate",function(){var t,e,a,o,i;_(this).attr("required")||_(this).hasClass("required")?(_(this).attr("required",!0),i=_(this).val(),t=_(this).attr("name"),o=_(this).closest("form"),a=_(this).attr("type"),!_(this).is("input")||"checkbox"!=a&&"radio"!=a||_(this).hasClass("plugin-privacy")?i?v._updateAddressFieldState.call(this,!0):v._updateAddressFieldState.call(this,!1):(o=_(this).closest("form"),e=t?_('input[type="'+a+'"][name="'+t+'"]',o):null,a=t?_('input[type="'+a+'"][name="'+t+'"]:checked',o):null,e&&e.length&&a&&!a.length?v._updateAddressFieldState.call(this,!1):v._updateAddressFieldState.call(this,!0)),i&&i.length&&("email"==t||"shipto_email"==t||"verify_email"==t)&&(i=_.trim(i),_(this).val(i),"email"!=t&&"shipto_email"!=t||(v.validateEmail(i)?o.find('input[name="verify_email"]').trigger("change"):v._updateAddressFieldState.call(this,!1)),"verify_email"!=t||(o=o.find('input[name="email"]').val())&&i!=o&&v._updateAddressFieldState.call(this,!1))):v._updateAddressFieldState.call(this,!0)})}).trigger("opcvalidate"),!(_(this).find("input.invalid").length||_(this).find("select.invalid").length||_(this).find("textarea.invalid").length)},v._updateAddressFieldState=function(t){var e=_(this).attr("id"),a=_(this).closest("form");(t=v.hasValue(t))?(_(this).removeClass("invalid"),e&&_('label[for="'+e+'"]',a).length&&_('label[for="'+e+'"]',a).removeClass("invalid")):(_(this).addClass("invalid"),e&&_('label[for="'+e+'"]',a).length&&_('label[for="'+e+'"]',a).addClass("invalid"))},v.close=function(t){_(t).parent(".proopc-alert").remove()},v.checkForError=function(t){if(t&&"object"===_.type(t)){if(typeof t.error==typeof u||!t.error)return!0;v.getcartlist(),v.removePageLoader(),v.enableSubmit();var e=f.JText._("PLG_VPONEPAGECHECKOUT_SYSTEM_ERROR_JS");typeof t.msg!=typeof u&&t.msg&&(e=t.msg),v.ajaxManager.setContinuous(!1),v.setmsg(1,e)}else{e=this.hasOwnProperty("error")?this.error:null;v.ajaxManager.setContinuous(!1),e&&"function"===_.type(e)&&e.call(this)}return!1},v.updateVATFieldState=function(t,e,a){var o=f._("EU_VAT_FIELD");a&&o&&(o=a+o),o&&"string"===_.type(o)&&_("input#"+o+"_field").length&&(t?(_("input#"+o+'_field, label[for="'+o+'_field"]').removeClass("invalid"),"object"===_.type(e)&&e.hasOwnProperty(o)&&_("input#"+o+"_field").val(e[o])):_("input#"+o+'_field, label[for="'+o+'_field"]').addClass("invalid"))},v.commonError=function(){v.removePageLoader(),v.enableSubmit(),v.setmsg(1,f.JText._("PLG_VPONEPAGECHECKOUT_SYSTEM_ERROR_JS"))},v.joomla4Fallback=function(){window.Joomla.Modal=window.Joomla.Modal||{},window.Joomla.Modal.current="",window.Joomla.Modal.setCurrent=function(t){window.Joomla.current=t},window.Joomla.Modal.getCurrent=function(){return window.Joomla.current},_(".joomla-modal").addClass("in")},v.submitOrder=function(o,t){if(!(t=v.hasValue(t))||1==t){if(_("#proopc-system-message").html(""),!v.validateAllForms())return!1;v.ajaxManager.setContinuous(!0),v.addPageLoader("PLG_VPONEPAGECHECKOUT_SAVING_BILLING_ADDRESS"),v.disableSubmit();var e=0;(a=_('#ProOPC input#STsameAsBT[type="checkbox"]')).length&&!a.is(":checked")||(e=1),v.ajaxManager.addReq({data:"ctask=savebtaddress&stage=final&STsameAsBT="+e+"&"+_("form#EditBTAddres").serialize()+"&"+v.getToken(),beforeSend:function(){v.addPageLoader("PLG_VPONEPAGECHECKOUT_SAVING_BILLING_ADDRESS"),v.disableSubmit()},success:function(t){if(!v.checkForError.call(this,t))return!1;v._triggerEvent("checkout.bt.saved"),v.addPageLoader("PLG_VPONEPAGECHECKOUT_BILLING_ADDRESS_SAVED"),v.submitOrder(o,2)},error:v.commonError},"savebtaddress")}if(2==t){var a=_('#ProOPC input#STsameAsBT[type="checkbox"]'),e=_('#proopc-hidden-confirm input[name="STsameAsBT"]:hidden'),i=_('#proopc-hidden-confirm input[name="shipto"]:hidden');if(!a.length||a.is(":checked"))return _(e).val(1),_(i).val(-1),v.submitOrder(o,3),!1;_(e).val(0),_(i).val(0),v.ajaxManager.addReq({data:"ctask=savestaddress&stage=final&"+_("form#EditSTAddres").serialize()+"&"+v.getToken(),beforeSend:function(){v.addPageLoader("PLG_VPONEPAGECHECKOUT_SAVING_SHIPPING_ADDRESS"),v.disableSubmit()},success:function(t){if(!v.checkForError.call(this,t))return!1;_(i).val(t.userinfo_id),v._triggerEvent("checkout.st.saved"),v.addPageLoader("PLG_VPONEPAGECHECKOUT_SHIPPING_ADDRESS_SAVED"),v.submitOrder(o,3)},error:v.commonError},"savestaddress")}if(3==t&&(0<_("input#vpopc_pp_express_selected").val()?v.submitOrder(o,4):v.ajaxManager.addReq({data:"ctask=setpayment&ajax=1&savecc=1&finalise=1&"+_("form#proopc-payment-form").serialize()+"&"+v.getToken(),beforeSend:function(){v.addPageLoader("PLG_VPONEPAGECHECKOUT_SAVING_CREDIT_CARD"),v.disableSubmit()},success:function(t,e,a){if(0<=a.getResponseHeader("content-type").indexOf("text/html")&&"undefined"!=typeof klarna){v.removePageLoader(),_("#proopc-order-process").remove(),_("<div />",{id:"proopc-temp",style:"display:none"}).appendTo("body"),_("#proopc-temp").append(t);a=_("#proopc-temp").find("div#system-message-container").html();return v.setmsg(1,a),v.enableSubmit(),!1}if("string"==typeof t&&(t=_.parseJSON(t)),!v.checkForError.call(this,t))return!1;0!=t.redirect?l.location=t.redirect:(v._triggerEvent("checkout.paymentmethod.saved"),v.addPageLoader("PLG_VPONEPAGECHECKOUT_CREDIT_CARD_SAVED"),v.submitOrder(o,4))},error:v.commonError},"setpayment")),4==t&&(e=_("form#checkoutForm").serialize(),_("form#cartFormFields").length&&(e+="&"+_("form#cartFormFields").serialize()),v.ajaxManager.addReq({data:"ctask=savecartfields&"+e,beforeSend:function(){v.disableSubmit()},success:function(t,e,a){if(!v.checkForError.call(this,t))return!1;v._triggerEvent("checkout.cartfields.saved"),v.submitOrder(o,5)},error:v.commonError},"savecartfields")),5==t&&v.ajaxManager.addReq({data:"ctask=verifycheckout",beforeSend:function(){v.addPageLoader("PLG_VPONEPAGECHECKOUT_VERIFYING_ORDER"),v.disableSubmit()},success:function(t,e,a){if(!v.checkForError.call(this,t))return v._triggerEvent("checkout.orderVerification.failed"),!1;v._triggerEvent("checkout.orderVerification.success"),v.submitOrder(o,6)},error:v.commonError},"verifycheckout"),6==t||"confirm"==t){v.addPageLoader("PLG_VPONEPAGECHECKOUT_PLACING_ORDER");var r=_("form#checkoutForm");if(!f._("ALL_OKAY",!0))return v.commonError(),!1;_("form#cartFormFields").length&&(_("#proopc-hidden-cart-fields").remove(),t=_("form#cartFormFields").children().clone(),t=_("<div></div>").attr("id","proopc-hidden-cart-fields").addClass("hide").append(t),_(r).append(t)),_(r).append(_("#proopc-hidden-confirm").html()),setTimeout(function(){_(r).submit()},100)}return!1},_(function(){f._("READY",!1)?(v.isMobile(),v.init(!0),v.initSpinner(),v.ajaxManager.run(),v.canCheckout(),v.setStyle(),v.inputwidth(),v.selectwidth(),v.bindFormValidator(),v.productdetails(),v.tooltip(),v.fieldTip(),v.defaultSP(!0),setTimeout(function(){v.joomla4Fallback()},200),_(l).on("proopc:saferesize",function(t,e){v.setStyle(),v.inputwidth(),v.selectwidth()}),_(o).on("ajaxStop",function(){v.init(),v.enableMethodSelection()}),_(o).on("ajaxError",function(){v.enableMethodSelection()}),_(l).on("load",function(){v.setStyle()})):console.error("VP One Page Checkout plugin is not ready.")}),l.addEventListener("orientationchange",function(){_(l).trigger("proopc:checkorientation")},!1),_(l).on("resize proopc:checkorientation",function(t){(t.type&&"proopc:checkorientation"===t.type||!v.isMobile())&&(v.cache.resizeTimeout&&clearTimeout(v.cache.resizeTimeout),v.cache.resizeTimeout=setTimeout(function(){_(l).trigger("proopc:saferesize",[t])},100))})}(ProOPC.jQuery,window,document,VPOPC,ProOPC);